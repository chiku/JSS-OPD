"use strict";var Application={Models:{},Collections:{},collections:{},Router:undefined,Views:{Encounters:{},Patients:{}},Configuration:{Urls:{},Selectors:{}},initialize:function(){new Application.Router;Backbone.history.start(),Application.collections.encounters.fetch()}};Application.Configuration.Selectors={main:'body div[role="main"]',appointments:"#appointments",encounters:"#encounters-container",patient:"#patient-container",encountersSort:"#encounters-sort",replaceByTimeago:".replace-by-timeago"},Application.Configuration.Urls={extension:"json",encounters:"/sampleWSResponses/encounter",patients:"/sampleWSResponses/patient"},Application.Models.Encounter=Backbone.Model.extend({patientId:function(){return this.patient().uuid},patientName:function(){return this.patient().display},providerName:function(){return this.provider().display},appointmentTime:function(){return this.get("encounterDatetime")},patient:function(){return this._retrivePropertiesFor("patient")},provider:function(){return this._retrivePropertiesFor("provider")},_retrivePropertiesFor:function(e){return this.get(e)||{}}}),Application.Models.Patient=Backbone.Model.extend({url:function(){var e=Application.Configuration.Urls;return e.patients+"/"+this.get("id")+"."+e.extension},parse:function(e){return e.id=e.uuid,e},blank:function(){return{preferredName:{display:undefined},preferredAddress:{display:undefined}}},person:function(){var e=this.get("person")||this.blank();return e.preferredName=e.preferredName||this.blank().preferredName,e.preferredAddress=e.preferredAddress||this.blank().preferredAddress,e},name:function(){return this.person().preferredName.display},age:function(){return this.person().age},address:function(){return this.person().preferredAddress.display},forceFetch:function(){this.fetch(),this.trigger("change")}}),Application.Collections.Encounters=Backbone.Collection.extend({model:Application.Models.Encounter,url:function(){var e=Application.Configuration.Urls;return e.encounters+"."+e.extension},initialize:function(){this.sortedBy="patientName"},parse:function(e){var t=e.results;return _(t).each(function(e){e.id=e.uuid}),t},comparator:function(e){return e.patientName()},reorderBy:function(t){return this._allowedReorderOn(t)&&(this.comparator=function(e){return e[t]()},this.sortedBy=t,this.sort(),this.trigger("encounter:sort",t)),this},_allowedReorderOn:function(e){return _(["patientName","providerName","appointmentTime"]).include(e)}}),Application.collections.encounters=new Application.Collections.Encounters,Application.Router=Backbone.Router.extend({routes:{"":"index",encounters:"index","patients/:id":"show"},initialize:function(){this.encountersView=new Application.Views.Encounters.Index({collection:Application.collections.encounters,encounterShowsContainerSelector:Application.Configuration.Selectors.encounters})},index:function(){this.encountersView.attachContentToCleanContainer()},show:function(){}}),jQuery(function(){Application.Views.Encounters.Index=Backbone.View.extend({tagName:"section",idName:"appointments",template:jQuery('<script type="text/template">    <header class="grey-gradient">Patients</header>    <section class="content">      <nav class="margin-bottom-gutter" id="encounters-filter">        <ul>          <li class="blue-gradient margin-right-gutter">Today</li>          <li class="grey-gradient margin-right-gutter">Pending</li>          <li class="grey-gradient">All</li>        <ul>      </nav>      <input type="text" class="search margin-bottom-gutter wide" />      <nav class="margin-bottom-gutter" id="encounters-sort">        <ul>          <li class="grey-gradient margin-right-gutter" data-sort-by="appointmentTime">Time</li>          <li class="grey-gradient margin-right-gutter" data-sort-by="providerName">Doctor</li>          <li class="blue-gradient margin-right-gutter" data-sort-by="patientName">Name</li>          <li class="grey-gradient">Urgency</li>        </ul>      </nav>      <section id="encounters-container"></section>    </section>  </script>').html(),initialize:function(e){this.encounterShowsContainerSelector=e.encounterShowsContainerSelector,this.collection.bind("reset",this.render,this);new Application.Views.Encounters.Sort({collection:this.collection})},render:function(){return jQuery(this.el).html(_.template(this.template)),this.collection.each(function(e){var t=new Application.Views.Encounters.Show({model:e});jQuery(this.encounterShowsContainerSelector).append(t.render().el)},this),jQuery(Application.Configuration.Selectors.replaceByTimeago).timeago(),this},attachContentToCleanContainer:function(){return jQuery(Application.Configuration.Selectors.appointments).empty().append(this.render().el),this}})}),jQuery(function(){Application.Views.Encounters.Show=Backbone.View.extend({tagName:"section",className:"encounter",events:{click:"showPatient"},template:jQuery('  <script type="text/template">    <section class="grey-gradient margin-bottom-gutter">      <img src="images/thumbnail.png" />      <section class="encounter-container">        <div class="patient"> <%= patient.display %> </div>        <div class="provider"> <%= provider.display %> </div>        <span>          <span class="number">411</span>          <span class="time replace-by-timeago" title="<%= encounterDatetime %>" ></span>        </span>      </section>    </li>  </script>').html(),initialize:function(){this.model.bind("change",this.render,this),this.patient=new Application.Models.Patient({id:this.model.get("patient").uuid}),this.patientView=new Application.Views.Patients.Show({model:this.patient})},render:function(){var e=_.template(this.template)(this.model.toJSON());return jQuery(this.el).html(e),this},showPatient:function(){this.patient.forceFetch()}})}),Application.Views.Encounters.Sort=Backbone.View.extend({el:function(){return jQuery(Application.Configuration.Selectors.encountersSort)},events:{click:"sortPatients"},initialize:function(){this.collection.bind("encounter:sort",this.activateSort,this)},sortPatients:function(e){var t=jQuery(e.target).attr("data-sort-by");t&&this.collection.reorderBy(t)},activateSort:function(){var e="li[data-sort-by='"+this.collection.sortedBy+"']";jQuery("nav#encounters-sort li").removeClass("blue-gradient").addClass("grey-gradient"),jQuery(e).addClass("blue-gradient").removeClass("grey-gradient")}}),jQuery(function(){Application.Views.Patients.Show=Backbone.View.extend({tagName:"section",className:"patient",template:jQuery('  <script type="text/template">    <div class="name"> <%= name() %> </div>    <div class="age"> Age: <%= age() %> </div>    <div class="address"> <%= address() %> </div>    <section class="patient-details">      <header>Patient History</header>      <section class="patient-information spacer">        <p>Some info from the screener to help the doctor or nurse with more information as they scroll through the patient list</p>      </section>      <header>Family History</header>      <section class="patient-information spacer">        <p>Some info from the screener to help the doctor or nurse with more information as they scroll through the patient list</p>      </section>      <header>Social History</header>      <section class="patient-information spacer">        <p>Some info from the screener to help the doctor or nurse with more information as they scroll through the patient list</p>      </section>      <header>Notes</header>      <section class="patient-information">        <p>Some info from the screener to help the doctor or nurse with more information as they scroll through the patient list</p>      </section>    </section>  </script>').html(),initialize:function(){this.model.bind("change",this.attachContentToCleanContainer,this)},render:function(){var e=_.template(this.template)(this.model);return jQuery(this.el).html(e),this},attachContentToCleanContainer:function(){return jQuery(Application.Configuration.Selectors.patient).empty().append(this.render().el),this}})}),jQuery(function(){var e=Application.Configuration.Selectors,t=jQuery(e.main);jQuery("<section>",{id:e.appointments.replace("#","")}).appendTo(t),jQuery("<section>",{id:e.patient.replace("#","")}).appendTo(t),Application.initialize()});