"use strict";var Application={Models:{},Collections:{},collections:{},Router:undefined,Views:{Encounters:{},Patients:{}},Configuration:{Urls:{},Selectors:{}},initialize:function(){var a=new Application.Router();Backbone.history.start();Application.collections.encounters.fetch()}};"use strict";Application.Configuration.Selectors={main:'body div[role="main"]',appointments:"#appointments",encounters:"#encounters-container",patient:"#patient-container",encountersSort:"#encounters-sort",replaceByTimeago:".replace-by-timeago",templates:{encounters:"#template-encounters",encounter:"#template-encounter",patient:"#template-patient"}};"use strict";Application.Configuration.Urls={extension:"json",encounters:"/sampleWSResponses/encounter",patients:"/sampleWSResponses/patient"};"use strict";Application.Models.Encounter=Backbone.Model.extend({patientId:function(){return this.patient().uuid},patientName:function(){return this.patient().display},providerName:function(){return this.provider().display},appointmentTime:function(){return this.get("encounterDatetime")},patient:function(){return this._retrivePropertiesFor("patient")},provider:function(){return this._retrivePropertiesFor("provider")},_retrivePropertiesFor:function(a){return this.get(a)||{}}});"use strict";Application.Models.Patient=Backbone.Model.extend({url:function(){var a=Application.Configuration.Urls;return a.patients+"/"+this.get("id")+"."+a.extension},parse:function(a){a.id=a.uuid;return a},blank:function(){return{preferredName:{display:undefined},preferredAddress:{display:undefined}}},person:function(){var a=this.get("person")||this.blank();a.preferredName=a.preferredName||this.blank().preferredName;a.preferredAddress=a.preferredAddress||this.blank().preferredAddress;return a},name:function(){return this.person().preferredName.display},age:function(){return this.person().age},address:function(){return this.person().preferredAddress.display},forceFetch:function(){this.fetch();this.trigger("change")}});"use strict";Application.Collections.Encounters=Backbone.Collection.extend({model:Application.Models.Encounter,url:function(){var a=Application.Configuration.Urls;return a.encounters+"."+a.extension},initialize:function(){this.sortedBy="patientName"},parse:function(a){var b=a.results;_(b).each(function(c){c.id=c.uuid});return b},comparator:function(a){return a.patientName()},reorderBy:function(a){if(!this._allowedReorderOn(a)){return this}this.comparator=function(b){return b[a]()};this.sortedBy=a;this.sort();this.trigger("encounter:sort",a);return this},_allowedReorderOn:function(a){return _(["patientName","providerName","appointmentTime"]).include(a)}});Application.collections.encounters=new Application.Collections.Encounters();"use strict";Application.Router=Backbone.Router.extend({routes:{"":"index",encounters:"index","patients/:id":"show"},initialize:function(){this.encountersView=new Application.Views.Encounters.Index({collection:Application.collections.encounters,encounterShowsContainerSelector:Application.Configuration.Selectors.encounters})},index:function(){this.encountersView.attachContentToCleanContainer()},show:function(a){}});"use strict";jQuery(function(){Application.Views.Encounters.Index=Backbone.View.extend({tagName:"section",idName:"appointments",template:jQuery(Application.Configuration.Selectors.templates.encounters).html(),initialize:function(a){this.encounterShowsContainerSelector=a.encounterShowsContainerSelector;this.collection.bind("reset",this.render,this);var b=new Application.Views.Encounters.Sort({collection:this.collection})},render:function(){jQuery(this.el).html(_.template(this.template));this.collection.each(function(a){var b=new Application.Views.Encounters.Show({model:a});jQuery(this.encounterShowsContainerSelector).append(b.render().el)},this);jQuery(Application.Configuration.Selectors.replaceByTimeago).timeago();return this},attachContentToCleanContainer:function(){jQuery(Application.Configuration.Selectors.appointments).empty().append(this.render().el);return this}})});"use strict";jQuery(function(){Application.Views.Encounters.Show=Backbone.View.extend({tagName:"section",className:"encounter",events:{click:"showPatient"},template:jQuery(Application.Configuration.Selectors.templates.encounter).html(),initialize:function(a){this.model.bind("change",this.render,this);this.patient=new Application.Models.Patient({id:this.model.get("patient").uuid});this.patientView=new Application.Views.Patients.Show({model:this.patient})},render:function(){var a=_.template(this.template)(this.model.toJSON());jQuery(this.el).html(a);return this},showPatient:function(){this.patient.forceFetch()}})});"use strict";jQuery(function(){Application.Views.Patients.Show=Backbone.View.extend({tagName:"section",className:"patient",template:jQuery(Application.Configuration.Selectors.templates.patient).html(),initialize:function(a){this.model.bind("change",this.attachContentToCleanContainer,this)},render:function(){var a=_.template(this.template)(this.model);jQuery(this.el).html(a);return this},attachContentToCleanContainer:function(){jQuery(Application.Configuration.Selectors.patient).empty().append(this.render().el);return this}})});"use strict";Application.Views.Encounters.Sort=Backbone.View.extend({el:function(){return jQuery(Application.Configuration.Selectors.encountersSort)},events:{click:"sortPatients"},initialize:function(){this.collection.bind("encounter:sort",this.activateSort,this)},sortPatients:function(b){var a=jQuery(b.target).attr("data-sort-by");if(!a){return}this.collection.reorderBy(a)},activateSort:function(){var a="li[data-sort-by='"+this.collection.sortedBy+"']";jQuery("nav#encounters-sort li").removeClass("blue-gradient").addClass("grey-gradient");jQuery(a).addClass("blue-gradient").removeClass("grey-gradient")}});"use strict";jQuery(function(){var b=Application.Configuration.Selectors,a=jQuery(b.main);jQuery("<section>",{id:b.appointments.replace("#","")}).appendTo(a);jQuery("<section>",{id:b.patient.replace("#","")}).appendTo(a);Application.initialize()});